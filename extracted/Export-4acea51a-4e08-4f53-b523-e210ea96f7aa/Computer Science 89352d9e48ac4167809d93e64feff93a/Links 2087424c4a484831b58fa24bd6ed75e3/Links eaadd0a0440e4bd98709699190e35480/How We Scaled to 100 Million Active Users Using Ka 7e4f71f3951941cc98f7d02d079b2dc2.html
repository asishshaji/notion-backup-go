<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>How We Scaled to 100 Million Active Users Using Kafka and Golang — Eventual Consistency</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="7e4f71f3-9519-41cc-98f7-d02d079b2dc2" class="page sans"><header><h1 class="page-title">How We Scaled to 100 Million Active Users Using Kafka and Golang — Eventual Consistency</h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-url"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesUrl"><path d="M7.69922 10.8945L8.73828 9.84863C7.91797 9.77344 7.34375 9.51367 6.91992 9.08984C5.76465 7.93457 5.76465 6.29395 6.91309 5.14551L9.18262 2.87598C10.3379 1.7207 11.9717 1.7207 13.127 2.87598C14.2891 4.04492 14.2822 5.67188 13.1338 6.82031L11.958 7.99609C12.1768 8.49512 12.2451 9.10352 12.1289 9.62988L14.0908 7.6748C15.7725 6 15.7793 3.62109 14.084 1.92578C12.3887 0.223633 10.0098 0.237305 8.33496 1.91211L5.95605 4.29785C4.28125 5.97266 4.26758 8.35156 5.96289 10.0469C6.36621 10.4434 6.90625 10.7441 7.69922 10.8945ZM8.30078 5.13184L7.26855 6.17773C8.08203 6.25293 8.66309 6.51953 9.08008 6.93652C10.2422 8.09863 10.2422 9.73242 9.08691 10.8809L6.81738 13.1504C5.66211 14.3057 4.03516 14.3057 2.87305 13.1504C1.71094 11.9883 1.71777 10.3545 2.87305 9.20605L4.04199 8.03027C3.83008 7.53125 3.75488 6.92969 3.87109 6.39648L1.91602 8.35156C0.234375 10.0264 0.227539 12.4121 1.92285 14.1074C3.61816 15.8027 5.99707 15.7891 7.67188 14.1143L10.0439 11.7354C11.7256 10.0537 11.7324 7.6748 10.0371 5.98633C9.64062 5.58301 9.10059 5.28223 8.30078 5.13184Z"></path></svg></span>URL</th><td><a href="https://itnext.io/how-we-scaled-to-100-million-active-users-using-kafka-and-golang-eventual-consistency-6241cfeba7e8" class="url-value">https://itnext.io/how-we-scaled-to-100-million-active-users-using-kafka-and-golang-eventual-consistency-6241cfeba7e8</a></td></tr><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>Category</th><td><span class="selected-value select-value-color-default">Design</span><span class="selected-value select-value-color-blue">Golang</span><span class="selected-value select-value-color-default">System Design</span></td></tr></tbody></table></header><div class="page-body"><figure id="ea3a3fbc-56a5-4e9e-8daf-c0013c52ed60" class="image"><a href="https://miro.medium.com/v2/resize:fit:858/1*EKg0Oo4woZeIdrX2vexPeA.png"><img style="width:672px" src="https://miro.medium.com/v2/resize:fit:858/1*EKg0Oo4woZeIdrX2vexPeA.png"/></a></figure><hr id="edd53645-fec9-4df3-956b-d52a8a4dbd02"/><p id="486e7f62-2341-446a-bcb4-23f7c57c35d9" class="">Nowadays, we have reached an era where the most popular startups reach millions of users within less than a year. During my experience as a software developer, where I had the privilege to work on a couple of them, I’ve seen that the most common bottleneck within a backend service is caused by I/O overhead. In this article, we will discuss the <strong>Eventual Consistency</strong> technique and how we can overcome I/O bottlenecks in scale by utilizing Kafka.</p><h1 id="9b22d0b1-7b83-4fad-a561-5b80a2f13aa0" class="">How simplicity allows Kafka to scale up to millions of messages per second</h1><p id="49fb27d4-faa7-4555-8e5e-c138700962eb" class="">Basically, a Kafka cluster consists of multiple servers, called brokers in the Kafka vocabulary, and one or more topics.</p><figure id="693f926e-465e-4e63-87ad-d23f3aee1da0" class="image"><a href="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1gQYItzs6sjU95oCHhnPwxg.png"><img style="width:620px" src="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1gQYItzs6sjU95oCHhnPwxg.png"/></a></figure><p id="573ec6dd-b7f1-42f2-9625-f01f7e83583f" class=""><strong>What is a topic in Kafka?</strong> A topic is a stream of messages with similar behaviors. They can be similar events, JSON, or anything as bytes. For instance, we had topics for published posts, comments, and likes, as well as action logs to study user experiences.</p><p id="f782e54c-0ea2-4471-b62c-69d1a3c595e1" class=""><strong>How is the structure of a topic in a cluster? </strong>Topics have two main properties: the number of partitions and replications. The replication determines how many copies we need from a topic to increase resiliency in case of broker failures. Before describing partitions, let’s discuss a message&#x27;s journey, from its publication to a topic until received and committed by a consumer.</p><figure id="81f7dfc2-ea6b-43e8-a57f-79dc16dbadb9" class="image"><a href="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1cV_2kAAcjjPjcQzJi_cnsw.png"><img style="width:700px" src="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1cV_2kAAcjjPjcQzJi_cnsw.png"/></a></figure><p id="da31541e-0b40-4ea1-aace-39a640e82745" class="">First, we have a happy message published by a producer going toward a topic. What will happen when the topic receives the message? A topic is not just one queue. It consists of one or more queues that we call <strong>partitions</strong>. These partitions can be located in one or more different brokers.</p><figure id="438c4cb1-415e-4248-b7d0-b9822bb1a12c" class="image"><a href="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1AC-CNlH_aZiRm8tN21W1Qw.png"><img style="width:700px" src="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1AC-CNlH_aZiRm8tN21W1Qw.png"/></a></figure><p id="0c69000f-ef4d-4c3c-8675-8ca458beeb61" class="">When the topic receives the message, the topic leader decides where to put the message. We can configure this behavior by using keys and distribution strategies. However, you can allow Kafka to distribute your messages fairly and randomly among partitions.</p><figure id="af33486e-2461-44f9-a2d4-3c6d810c6642" class="image"><a href="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1EKg0Oo4woZeIdrX2vexPeA.png"><img style="width:700px" src="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1EKg0Oo4woZeIdrX2vexPeA.png"/></a></figure><p id="bf19950b-f0e9-4142-bac7-fe5afff46022" class="">Each consumer can read from one or more partitions. The key point is that no more than one consumer can read from a partition. <strong>What does it mean?</strong></p><figure id="50c135ef-0204-42e9-8dbe-9deeec55e5b0" class="image"><a href="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/18huhjb-Wmq2sO2lzGxqiwA.png"><img style="width:700px" src="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/18huhjb-Wmq2sO2lzGxqiwA.png"/></a></figure><p id="55a46868-c0ba-45a5-80c0-e76acdfcfba0" class="">If we have more consumers than partitions, excess consumers will starve! At first, I thought it was going to limit us a lot. But this behavior allows Kafka to scale out partitions dependently and achieve millions of messages per second.</p><h1 id="8058227b-5042-4d70-9e63-170fd75244db" class="">Eventual Consistency — In eventuality, we trust!</h1><p id="429c8b3c-75c0-4d3a-8458-94d86affd039" class="">Let’s explore different scenarios. Posting a new Instagram photo, a new tweet, a new comment on Amazon, liking a photo, uploading a new avatar, or looking at a photo! In the traditional way, when a client sends an HTTP request to upload a new photo, the backend holds that request until the request is either successful or failed. But there is another approach to it that suits well with asynchronous programming.</p><p id="6d45e72b-b5c2-434d-8bba-100178db3b98" class=""><strong>How much should It take until our followers receive a new tweet? </strong>100 milliseconds, one second, one minute, or five minutes? As Twitter has mentioned in their articles, they are happy with less than five seconds. In our case, in request peaks with way fewer resources than Twitter, we were happy with less than a minute. The key point is that in many scenarios, we are okay with seconds of delays, but we do not need to hold the user until the request is finished. Imagine waiting 5 seconds to tweet each time.</p><p id="cc69096e-49a5-441a-8c58-8f51d23984e6" class="">In other scenarios, like gathering action logs to compute user behaviors later, we do not need messages instantly. Hence, making users wait until the application saves their log is not logical at all. Besides that, Kafka has powerful integrations with other tools, such as ELK and Flink, to work on streams of messages.</p><p id="b32489a7-8553-4dba-ba08-7d36ad153988" class="">The second reason I should mention that makes an application slow is I/O bottlenecks. Assume we need to build a blogging service. By separating reads from writes, we can scale databases independently. For instance, we can have a relational database that supports transactions for insert queries, and after the data have been saved, it publishes a new event that synchronizes read databases. Read databases, therefore, don’t need to be as complicated as write databases and can be optimized just for read queries.</p><p id="f2d9ca6f-561d-4a52-b84c-727f9a7abf9c" class="">One of the most useful techniques that we used to handle around 10 million requests per hour was utilizing Redis as the read database. I was working on services that directly respond to GET requests for editorial pages. We processed every page and then saved them in the Redis. And whenever there was a change within a page, a Kafka event was triggered to update the cache. Therefore, the Redis was always updated, and we were able to answer requests as fast as possible.</p><figure id="851ee19f-05c3-4d89-8e58-1e72d5a64d97" class="image"><a href="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1UC_ZwL4T24kMLwxDs75K0w.png"><img style="width:700px" src="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1UC_ZwL4T24kMLwxDs75K0w.png"/></a></figure><p id="273a1ee4-c016-490b-946c-db6d43c38762" class="">Why do we have two different topics? Because in many cases, your team is only in charge of one part of the page, and other teams are updating other entities, and your team doesn’t need to be worried about it. Using a message broker provides decoupling, less complexity in services, and resilience and scalability by eventual consistency.</p><h1 id="2845eb25-7641-447c-a779-5feb74faea5d" class="">Let’s Build a Blogging Service</h1><p id="5ffdb1ed-c63d-4a78-af23-7a250e3219bf" class="">Let’s build a sample service that utilizes Kafka and Redis to implement eventual consistency. While setting up Kafka and Redis in the development environment is not that challenging, having a resilient and scalable Kafka and Redis cluster on the cloud requires years of experience.</p><blockquote id="bb67ca17-2b14-4851-86da-132bdb73c6f6" class="">We will be using Upstash’s free Kafka and Redis clusters in this article. Their free-tier Kafka and Redis clusters support up to 10k messages per day which is more than enough for development environment.</blockquote><p id="df8306a7-1d4f-4bef-a8c5-6ffc34aa0c0d" class="">To create your cluster, <a href="https://upstash.com/?utm_source=Mohammad1"><strong>click here</strong></a> and create a new Upstash account. Go to the Kafka tab and click on the create cluster button.</p><figure id="29892bab-b8eb-4700-9a94-6cecdd7ba548" class="image"><a href="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1jLCZ7LYyHvObsCaaBJGwZg.png"><img style="width:601px" src="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1jLCZ7LYyHvObsCaaBJGwZg.png"/></a></figure><p id="34376a82-4a04-4e60-a864-6da0f362f01a" class="">As you can see, you can select between multiple regions and choose the replication factor. We are going to use this topic for the testing environment, so I’ll leave it on Single Replica.</p><figure id="84889a00-4472-4012-8087-c3c3db647af4" class="image"><a href="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1cwSzx0e1VyLCI4eqE-Hv-A.png"><img style="width:700px" src="How%20We%20Scaled%20to%20100%20Million%20Active%20Users%20Using%20Ka%207e4f71f3951941cc98f7d02d079b2dc2/1cwSzx0e1VyLCI4eqE-Hv-A.png"/></a></figure></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>